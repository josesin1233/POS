{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Ventas</title>
  <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
  <link rel="alternate icon" href="{% static 'favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/tailwind-production.css' %}">
  <link rel="stylesheet" href="{% static 'css/scanner.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }

    :root {
      --bg-primary: #111111;
      --bg-secondary: #000000;
      --bg-tertiary: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --border-color: #333333;
      --accent-blue: #00d4ff;
      --accent-green: #00ff88;
    }

    body {
      background-color: #000000;
      color: var(--text-primary);
    }

    .modern-button {
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .modern-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
      border-color: var(--accent-blue);
      background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
    }

    .modern-button.primary {
      background: linear-gradient(135deg, var(--accent-blue) 0%, #0099cc 100%);
      border-color: var(--accent-blue);
      color: #000000;
    }

    .modern-card {
      background: #0a0a0a;
      border: 2px solid var(--border-color);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.1);
    }

    input, select {
      color: #f9fafb !important;
    }

    input::placeholder {
      color: #9ca3af !important;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-blue) !important;
      box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2) !important;
      color: #f9fafb !important;
    }

    select option {
      background-color: #1f2937;
      color: #f9fafb;
    }

    .tab-button {
      transition: all 0.2s ease;
    }

    .tab-button:hover {
      border-color: var(--accent-blue) !important;
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%) !important;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.2) !important;
      transform: translateY(-1px) scale(1.02);
    }

    .tab-button-active {
      box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4) !important;
    }

    .clickable-row {
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .clickable-row:hover {
      background-color: rgba(0, 212, 255, 0.1);
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Navigation -->
  <nav class="border-b shadow-sm" style="background-color: #111111; border-color: #333333;">
    <div class="max-w-full mx-auto px-4 py-1.5">
      <div class="flex items-center justify-between">
        <div class="text-lg font-bold text-primary">{{ business.name|default:"DulcePOS" }}</div>

        <div class="flex items-center space-x-2">
          <a href="/punto_de_venta/" class="text-secondary hover:text-blue-600 font-medium text-xs">← Volver al POS</a>
          <a href="/accounts/logout/" class="text-secondary hover:text-blue-600 font-medium text-xs">Salir</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Tabs Navigation -->
  <div class="border-b" style="background-color: #111111; border-color: #333333;">
    <div class="max-w-full mx-auto px-4 py-2">
      <div class="flex flex-wrap gap-2">
        <a href="/punto_de_venta/" class="tab-button px-4 py-2 rounded-lg font-medium text-sm transition-all hover:scale-105" style="background: var(--bg-secondary); border: 2px solid var(--border-color); color: var(--text-primary);">
          Punto de Venta
        </a>
        <a href="/inventario/" class="tab-button px-4 py-2 rounded-lg font-medium text-sm transition-all hover:scale-105" style="background: var(--bg-secondary); border: 2px solid var(--border-color); color: var(--text-primary);">
          Inventario
        </a>
        <a href="/ventas/" class="tab-button-active px-4 py-2 rounded-lg font-semibold text-sm transition-all" style="background: linear-gradient(135deg, var(--accent-blue) 0%, #0099cc 100%); color: #000000;">
          Registro
        </a>
        <a href="/caja/" class="tab-button px-4 py-2 rounded-lg font-medium text-sm transition-all hover:scale-105" style="background: var(--bg-secondary); border: 2px solid var(--border-color); color: var(--text-primary);">
          Caja
        </a>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto p-6">
    <!-- Header -->
    <div class="modern-card p-6 mb-6">
      <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold" style="color: var(--text-primary);">Registro de Ventas</h1>
        <div class="text-right">
          <div class="text-sm" style="color: var(--text-secondary);">Total del día</div>
          <div class="text-2xl font-bold" style="color: var(--accent-green);" id="total-dia">$0.00</div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="modern-card p-4 mb-6">
      <form id="filtro-form" class="flex flex-wrap items-end gap-3">
        <div class="flex-1 min-w-32">
          <label class="block text-xs font-medium mb-1" style="color: var(--text-secondary);">Día:</label>
          <input type="date" id="filtro-dia" class="w-full p-2 text-sm rounded" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);" />
        </div>
        <div class="flex-1 min-w-32">
          <label class="block text-xs font-medium mb-1" style="color: var(--text-secondary);">Mes:</label>
          <input type="month" id="filtro-mes" class="w-full p-2 text-sm rounded" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);" />
        </div>
        <div class="flex-1 min-w-24">
          <label class="block text-xs font-medium mb-1" style="color: var(--text-secondary);">Año:</label>
          <input type="number" id="filtro-anio" class="w-full p-2 text-sm rounded" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);" placeholder="2025" min="2000" />
        </div>
        <div>
          <button type="submit" class="modern-button primary px-4 py-2 text-sm">Filtrar</button>
        </div>
        <div>
          <button type="button" onclick="limpiarFiltros()" class="modern-button px-4 py-2 text-sm">Limpiar</button>
        </div>
      </form>
    </div>

    <!-- Sales Table -->
    <div class="modern-card">
      <div class="p-4" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color); border-radius: 16px 16px 0 0;">
        <h3 class="text-lg font-semibold" style="color: var(--text-primary);">Historial de Ventas</h3>
      </div>
      <div class="overflow-auto" style="max-height: 70vh;">
        <table class="text-sm text-left w-full" id="tabla-ventas" style="min-width: 900px;">
          <thead style="background: var(--bg-tertiary); color: var(--text-primary); border-bottom: 2px solid var(--border-color);" class="sticky top-0">
            <tr>
              <th class="p-3 font-medium" style="min-width: 200px;">Producto</th>
              <th class="p-3 font-medium text-center" style="min-width: 70px;">Cant.</th>
              <th class="p-3 font-medium text-right" style="min-width: 100px;">Precio Unit.</th>
              <th class="p-3 font-medium text-right" style="min-width: 100px;">Total</th>
              <th class="p-3 font-medium text-center" style="min-width: 120px;">Usuario</th>
              <th class="p-3 font-medium text-center" style="min-width: 100px;">Método Pago</th>
              <th class="p-3 font-medium text-center" style="min-width: 120px;">Stock</th>
            </tr>
          </thead>
          <tbody id="tabla-ventas-body">
            <tr>
              <td colspan="7" class="p-6 text-center" style="color: var(--text-secondary);">
                Cargando ventas...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
  const tabla = document.querySelector("#tabla-ventas-body");
  const totalDiaSpan = document.getElementById("total-dia");
  const formFiltro = document.getElementById("filtro-form");

  function formatearPesos(monto) {
    return new Intl.NumberFormat('es-MX', {
      style: 'currency',
      currency: 'MXN',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(monto);
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  async function cargarVentas(queryParams = "") {
    try {
      const res = await fetch(`/registro/completo/${queryParams}`, {
        method: 'GET',
        credentials: 'same-origin',
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': getCookie('csrftoken')
        }
      });

      if (!res.ok) {
        throw new Error(`Error ${res.status}: ${res.statusText}`);
      }

      const data = await res.json();
      console.log('Datos recibidos:', data);

      tabla.innerHTML = "";

      if (data.total_del_dia !== undefined) {
        totalDiaSpan.textContent = formatearPesos(data.total_del_dia);
      }

      if (data.es_vista_jerarquica && data.grupos_jerarquicos) {
        renderizarVistaJerarquica(data.grupos_jerarquicos);
      } else if (data.actividades && data.actividades.length > 0) {
        renderizarActividades(data.actividades);
      } else {
        mostrarMensajeVacio();
      }
    } catch (error) {
      console.error("Error al cargar ventas:", error);
      tabla.innerHTML = `
        <tr>
          <td colspan="7" class="p-6 text-center" style="color: #ef4444;">
            Error al cargar las ventas: ${error.message}
          </td>
        </tr>
      `;
      totalDiaSpan.textContent = "$0.00";
    }
  }

  function renderizarActividades(actividades) {
    actividades.forEach(actividad => {
      const fecha = new Date(actividad.fecha).toLocaleString('es-MX');

      if (actividad.tipo === 'venta') {
        // Header de la venta
        const filaHeader = document.createElement("tr");
        filaHeader.className = "clickable-row";
        filaHeader.style.background = "var(--bg-tertiary)";
        filaHeader.style.borderBottom = "1px solid var(--border-color)";
        filaHeader.style.cursor = "pointer";
        const ventaId = `venta-${actividad.id || Date.now()}`;
        filaHeader.onclick = () => toggleVenta(ventaId);
        filaHeader.innerHTML = `
          <td colspan="7" class="p-3 font-semibold" style="color: var(--accent-blue);">
            Venta #${actividad.id} del ${fecha} - Total: ${formatearPesos(actividad.total)}
            - Usuario: ${actividad.usuario} - Método: ${actividad.metodo_pago}
            <span id="toggle-${ventaId}" style="float: right;"></span>
          </td>
        `;
        tabla.appendChild(filaHeader);

        // Productos de la venta
        actividad.productos.forEach(producto => {
          const movimiento = actividad.movimientos_stock ?
            actividad.movimientos_stock.find(mov => mov.producto === producto.nombre) : null;
          const stockInfo = movimiento ?
            `${movimiento.stock_anterior} → ${movimiento.stock_nuevo}` : 'Sin registro';

          const fila = document.createElement("tr");
          fila.setAttribute('data-venta-id', ventaId);
          fila.style.display = 'none';
          fila.style.borderBottom = "1px solid var(--border-color)";
          fila.innerHTML = `
            <td class="p-3" style="color: var(--text-primary); padding-left: 2rem;">${producto.nombre}</td>
            <td class="p-3 text-center" style="color: var(--text-primary);">${producto.cantidad}</td>
            <td class="p-3 text-right" style="color: var(--text-primary);">${formatearPesos(producto.precio_unitario)}</td>
            <td class="p-3 text-right font-semibold" style="color: var(--accent-green);">${formatearPesos(producto.subtotal)}</td>
            <td class="p-3 text-center" style="color: var(--text-secondary);">${actividad.usuario}</td>
            <td class="p-3 text-center" style="color: var(--accent-blue);">${actividad.metodo_pago}</td>
            <td class="p-3 text-center" style="color: var(--text-secondary); font-size: 0.75rem;">${stockInfo}</td>
          `;
          tabla.appendChild(fila);
        });
      } else if (actividad.tipo === 'movimiento_stock') {
        // Movimiento de inventario
        const filaHeader = document.createElement("tr");
        filaHeader.style.background = "linear-gradient(135deg, #2a5a2a 0%, #1a4a1a 100%)";
        filaHeader.style.borderBottom = "1px solid var(--border-color)";
        filaHeader.innerHTML = `
          <td colspan="7" class="p-3 font-semibold" style="color: #90EE90;">
            Movimiento de Stock del ${fecha} - Usuario: ${actividad.usuario}
            ${actividad.motivo ? `- Motivo: ${actividad.motivo}` : ''}
          </td>
        `;
        tabla.appendChild(filaHeader);

        const cantidad_text = actividad.producto.cantidad_movida > 0 ?
          `+${actividad.producto.cantidad_movida}` : `${actividad.producto.cantidad_movida}`;

        const fila = document.createElement("tr");
        fila.style.borderBottom = "1px solid var(--border-color)";
        fila.style.background = "rgba(144, 238, 144, 0.05)";
        fila.innerHTML = `
          <td class="p-3" style="color: var(--text-primary); padding-left: 2rem;">${actividad.producto.nombre}</td>
          <td class="p-3 text-center" style="color: ${actividad.producto.cantidad_movida > 0 ? '#90EE90' : '#FF6B6B'}; font-weight: 600;">${cantidad_text}</td>
          <td class="p-3 text-right" style="color: var(--text-secondary);">-</td>
          <td class="p-3 text-right" style="color: var(--text-secondary);">-</td>
          <td class="p-3 text-center" style="color: var(--text-secondary);">${actividad.usuario}</td>
          <td class="p-3 text-center" style="color: var(--text-secondary);">Movimiento</td>
          <td class="p-3 text-center" style="color: var(--text-secondary); font-size: 0.75rem;">${actividad.producto.stock_anterior} → ${actividad.producto.stock_nuevo}</td>
        `;
        tabla.appendChild(fila);
      }
    });
  }

  function renderizarVistaJerarquica(gruposAnios) {
    gruposAnios.forEach(anio => {
      // Header del año
      const anioHeader = crearHeaderGrupo(
        `Año ${anio.titulo} - Total: ${formatearPesos(anio.total)}`,
        `anio-${anio.titulo}`,
        anio.titulo === new Date().getFullYear().toString()
      );
      tabla.appendChild(anioHeader);

      anio.meses.forEach(mes => {
        // Header del mes
        const mesHeader = crearHeaderGrupo(
          `${mes.titulo} - Total: ${formatearPesos(mes.total)}`,
          `mes-${anio.titulo}-${mes.titulo.replace(/\s+/g, '-')}`,
          false,
          '2rem'
        );
        mesHeader.setAttribute('data-grupo-id', `anio-${anio.titulo}`);
        mesHeader.style.display = anio.titulo === new Date().getFullYear().toString() ? 'table-row' : 'none';
        tabla.appendChild(mesHeader);

        mes.semanas.forEach(semana => {
          // Header de la semana
          const semanaHeader = crearHeaderGrupo(
            `${semana.titulo} - Total: ${formatearPesos(semana.total)}`,
            `semana-${anio.titulo}-${mes.titulo.replace(/\s+/g, '-')}-${semana.titulo.replace(/\s+/g, '-')}`,
            false,
            '3rem'
          );
          semanaHeader.setAttribute('data-grupo-id', `mes-${anio.titulo}-${mes.titulo.replace(/\s+/g, '-')}`);
          semanaHeader.style.display = 'none';
          tabla.appendChild(semanaHeader);

          semana.dias.forEach(dia => {
            // Header del día
            const diaHeader = crearHeaderGrupo(
              `${dia.titulo} - Total: ${formatearPesos(dia.total)}${dia.es_hoy ? ' (HOY)' : ''}`,
              `dia-${dia.fecha.replace(/-/g, '')}`,
              dia.es_hoy,
              '4rem'
            );
            diaHeader.setAttribute('data-grupo-id', `semana-${anio.titulo}-${mes.titulo.replace(/\s+/g, '-')}-${semana.titulo.replace(/\s+/g, '-')}`);
            diaHeader.style.display = dia.es_hoy ? 'table-row' : 'none';
            tabla.appendChild(diaHeader);

            // Ventas del día
            const ventas = dia.actividades.filter(actividad => actividad.tipo === 'venta');
            ventas.forEach((venta, index) => {
              const ventaId = `venta-${dia.fecha.replace(/-/g, '')}-${index}`;
              const fecha = new Date(venta.fecha).toLocaleString('es-MX', {
                hour: '2-digit',
                minute: '2-digit',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
              });

              // Header de la venta
              const ventaHeader = document.createElement("tr");
              ventaHeader.className = "clickable-row";
              ventaHeader.style.background = "rgba(0, 123, 255, 0.1)";
              ventaHeader.style.borderBottom = "1px solid var(--border-color)";
              ventaHeader.style.cursor = "pointer";
              ventaHeader.setAttribute('data-grupo-id', `dia-${dia.fecha.replace(/-/g, '')}`);
              ventaHeader.style.display = dia.es_hoy ? 'table-row' : 'none';
              ventaHeader.onclick = () => toggleVenta(ventaId);
              ventaHeader.innerHTML = `
                <td colspan="7" class="p-2 text-sm font-medium" style="color: var(--accent-blue); padding-left: 5rem;">
                  Venta #${venta.id} - ${formatearPesos(venta.total)} - ${venta.productos.length} items - ${venta.metodo_pago} - ${venta.usuario} - ${fecha}
                  <span id="toggle-${ventaId}" style="float: right;"></span>
                </td>
              `;
              tabla.appendChild(ventaHeader);

              // Productos de la venta
              venta.productos.forEach(producto => {
                const movimiento = venta.movimientos_stock ?
                  venta.movimientos_stock.find(mov => mov.producto === producto.nombre) : null;
                const stockInfo = movimiento ?
                  `${movimiento.stock_anterior} → ${movimiento.stock_nuevo}` : 'Sin registro';

                const fila = document.createElement("tr");
                fila.setAttribute('data-venta-id', ventaId);
                fila.setAttribute('data-grupo-id', `dia-${dia.fecha.replace(/-/g, '')}`);
                fila.style.display = 'none';
                fila.style.borderBottom = "1px solid var(--border-color)";
                fila.style.background = "rgba(0, 123, 255, 0.02)";
                fila.innerHTML = `
                  <td class="p-2 text-sm" style="color: var(--text-primary); padding-left: 6rem;">${producto.nombre}</td>
                  <td class="p-2 text-sm text-center" style="color: var(--text-primary);">${producto.cantidad}</td>
                  <td class="p-2 text-sm text-right" style="color: var(--text-primary);">${formatearPesos(producto.precio_unitario)}</td>
                  <td class="p-2 text-sm text-right font-semibold" style="color: var(--accent-green);">${formatearPesos(producto.subtotal)}</td>
                  <td class="p-2 text-sm text-center" style="color: var(--text-secondary);">${venta.usuario}</td>
                  <td class="p-2 text-sm text-center" style="color: var(--accent-blue);">${venta.metodo_pago}</td>
                  <td class="p-2 text-sm text-center" style="color: var(--text-secondary); font-size: 0.75rem;">${stockInfo}</td>
                `;
                tabla.appendChild(fila);
              });
            });

            // Movimientos de stock del día
            const movimientos = dia.actividades.filter(actividad => actividad.tipo === 'movimiento_stock');
            movimientos.forEach(actividad => {
              const cantidad_text = actividad.producto.cantidad_movida > 0 ?
                `+${actividad.producto.cantidad_movida}` : `${actividad.producto.cantidad_movida}`;

              const fila = document.createElement("tr");
              fila.setAttribute('data-grupo-id', `dia-${dia.fecha.replace(/-/g, '')}`);
              fila.style.display = dia.es_hoy ? 'table-row' : 'none';
              fila.style.borderBottom = "1px solid var(--border-color)";
              fila.style.background = "rgba(144, 238, 144, 0.05)";
              fila.innerHTML = `
                <td class="p-2 text-sm" style="color: var(--text-primary); padding-left: 5rem;">${actividad.producto.nombre}</td>
                <td class="p-2 text-sm text-center" style="color: ${actividad.producto.cantidad_movida > 0 ? '#90EE90' : '#FF6B6B'}; font-weight: 600;">${cantidad_text}</td>
                <td class="p-2 text-sm text-right" style="color: var(--text-secondary);">-</td>
                <td class="p-2 text-sm text-right" style="color: var(--text-secondary);">-</td>
                <td class="p-2 text-sm text-center" style="color: var(--text-secondary);">${actividad.usuario}</td>
                <td class="p-2 text-sm text-center" style="color: var(--text-secondary);">Movimiento</td>
                <td class="p-2 text-sm text-center" style="color: var(--text-secondary); font-size: 0.75rem;">${actividad.producto.stock_anterior} → ${actividad.producto.stock_nuevo}</td>
              `;
              tabla.appendChild(fila);
            });
          });
        });
      });
    });
  }

  function crearHeaderGrupo(titulo, grupoId, abierto = false, paddingLeft = '1rem') {
    const header = document.createElement("tr");
    header.className = "clickable-row";
    header.style.background = "var(--bg-tertiary)";
    header.style.borderBottom = "1px solid var(--border-color)";
    header.style.cursor = "pointer";
    header.onclick = () => toggleGrupo(grupoId);
    header.innerHTML = `
      <td colspan="7" class="p-3 font-medium" style="color: var(--text-primary); padding-left: ${paddingLeft};">
        ${titulo}
        <span id="toggle-${grupoId}" style="float: right;">${abierto ? '' : ''}</span>
      </td>
    `;
    return header;
  }

  function toggleGrupo(grupoId) {
    const elementos = document.querySelectorAll(`[data-grupo-id="${grupoId}"]`);
    const toggle = document.getElementById(`toggle-${grupoId}`);

    if (elementos.length > 0 && toggle) {
      const isHidden = elementos[0].style.display === 'none';
      elementos.forEach(elem => {
        elem.style.display = isHidden ? 'table-row' : 'none';
        // Si estamos cerrando, cerrar también todos los hijos
        if (!isHidden && elem.id && elem.id.startsWith('toggle-')) {
          const elemId = elem.id.replace('toggle-', '');
          const hijos = document.querySelectorAll(`[data-grupo-id="${elemId}"]`);
          hijos.forEach(hijo => hijo.style.display = 'none');
        }
      });
      toggle.textContent = isHidden ? '' : '';
    }
  }

  function toggleVenta(ventaId) {
    const filas = document.querySelectorAll(`[data-venta-id="${ventaId}"]`);
    const toggle = document.getElementById(`toggle-${ventaId}`);

    if (filas.length > 0 && toggle) {
      const isHidden = filas[0].style.display === 'none';
      filas.forEach(fila => {
        fila.style.display = isHidden ? 'table-row' : 'none';
      });
      toggle.textContent = isHidden ? '' : '';
    }
  }

  function mostrarMensajeVacio() {
    const filaVacia = document.createElement("tr");
    filaVacia.innerHTML = `
      <td colspan="7" class="p-6 text-center" style="color: var(--text-secondary);">
        No hay actividades registradas en el período seleccionado
      </td>
    `;
    tabla.appendChild(filaVacia);
  }

  function limpiarFiltros() {
    document.getElementById('filtro-dia').value = '';
    document.getElementById('filtro-mes').value = '';
    document.getElementById('filtro-anio').value = '';
    cargarVentas();
  }

  // Event listeners
  document.addEventListener('DOMContentLoaded', function() {
    cargarVentas();
  });

  formFiltro.addEventListener("submit", e => {
    e.preventDefault();
    const dia = document.getElementById("filtro-dia").value;
    const mes = document.getElementById("filtro-mes").value;
    const anio = document.getElementById("filtro-anio").value;

    const params = new URLSearchParams();
    if (dia) params.append("dia", dia);
    if (mes) params.append("mes", mes);
    if (anio) params.append("anio", anio);

    const queryString = params.toString();
    cargarVentas(queryString ? "?" + queryString : "");
  });
</script>

<script src="{% static 'js/barcode-scanner.js' %}"></script>
<script src="{% static 'js/tutorial-helper.js' %}"></script>
</body>
</html>
